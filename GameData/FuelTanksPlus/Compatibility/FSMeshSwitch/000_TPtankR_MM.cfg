// This patch now includes support for B9 Part Switch along with Firespitter and Interstellar Fuel Switch.
// Prefered fuel switch is B9PartSwitch

@PART[TPtankR??]:NEEDS[B9PartSwitch&!CryoTanks&!ModularFuelTanks&!RealFuels]:FOR[FuelTanksPlus]
{
    // --- temp values stored in a disposable node ---
    __TMP_FTP_B9PS
    {
        %totalCap = #$../RESOURCE[LiquidFuel]/maxAmount$
        @totalCap += #$../RESOURCE[Oxidizer]/maxAmount$

        %massOffset = #$../mass$
        @massOffset *= -1
    }

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = fuelSwitch
		switcherDescription = Tank Type
		baseVolume = #$../__TMP_FTP_B9PS/totalCap$

		SUBTYPE
		{
			name = MonoPropellant
			tankType = FTPMonoPropellant
			addedMass = #$../../__TMP_FTP_B9PS/massOffset$
			TEXTURE
			{
				baseTransform = TPtankR-rim
				texture = FuelTanksPlus/Assets/Radial/TPtankR-rimGold-Specular
			}
		}
		SUBTYPE
		{
			name = LF/O
			tankType = FTPLFO
			addedMass = #$../../__TMP_FTP_B9PS/massOffset$
			TEXTURE
			{
				baseTransform = TPtankR-rim
				texture = FuelTanksPlus/Assets/Radial/TPtankR-rimBlack-Specular
			}
		}
		SUBTYPE
		{
			name = LiquidFuel
			tankType = FTPLiquidFuel
			addedMass = #$../../__TMP_FTP_B9PS/massOffset$
			TEXTURE
			{
				baseTransform = TPtankR-rim
				texture = FuelTanksPlus/Assets/Radial/TPtankR-rimRed-Specular
			}
		}
		SUBTYPE
		{
			name = Oxidizer
			tankType = FTPOxidizer
			addedMass = #$../../__TMP_FTP_B9PS/massOffset$
			TEXTURE
			{
				baseTransform = TPtankR-rim
				texture = FuelTanksPlus/Assets/Radial/TPtankR-rimBlue-Specular
			}
		}
	}
	!RESOURCE[LiquidFuel] {}
	!RESOURCE[Oxidizer] {}
    // --- delete the temp node so nothing “lingers” in the final part ---
    !__TMP_FTP_B9PS {}
}

@PART[TPtankR??]:NEEDS[Firespitter|InterstellarFuelSwitch&!CryoTanks&!ModularFuelTanks&!RealFuels&!B9PartSwitch]:AFTER[FuelTanksPlus]
{
	MODULE
	{
		name:NEEDS[!InterstellarFuelSwitch] = FStextureSwitch2
		name:NEEDS[InterstellarFuelSwitch] = InterstellarTextureSwitch2
		hasSwitchChooseOption:NEEDS[InterstellarFuelSwitch] = False
		tankSwitchNames:NEEDS[InterstellarFuelSwitch] = MonoProp;LF+OX;LiquidFuel;Oxidizer
		textureRootFolder = FuelTanksPlus/Assets/Radial/
		textureNames = TPtankR-rimGold-Specular;TPtankR-rimBlack-Specular;TPtankR-rimRed-Specular;TPtankR-rimBlue-Specular
		textureDisplayNames = MonoPropellant;LF+OX;LiquidFuel;Oxidizer
		useFuelSwitchModule = true
		fuelTankSetups = 0; 1; 2; 3
		objectNames = TPtankR-rim
		nextButtonText = Next Variant
		prevButtonText = Previous Variant
		statusText = Current Variant
	}
}

@PART[TPtankR01]:NEEDS[Firespitter|InterstellarFuelSwitch&!CryoTanks&!ModularFuelTanks&!RealFuels&!B9PartSwitch]:AFTER[FuelTanksPlus]
{
	//@mass = 0
	MODULE
	{
		name:NEEDS[!InterstellarFuelSwitch] = FSfuelSwitch
		name:NEEDS[InterstellarFuelSwitch] = InterstellarFuelSwitch
		useTextureSwitchModule:NEEDS[InterstellarFuelSwitch] = True
		tankSwitchNames:NEEDS[InterstellarFuelSwitch] = MonoProp;LF+OX;LiquidFuel;Oxidizer
		resourceNames = MonoPropellant;LiquidFuel,Oxidizer;LiquidFuel;Oxidizer
		resourceAmounts = 125;45,55;90;110
		//tankMass = 0.025;0.035;0.035;0.035
		//basePartMass = 0.0

		tankMass = 0;0.015;0.015;0.015
		basePartMass = #$../mass$

		displayCurrentTankCost = true
		hasGUI = false
		availableInFlight = false
		availableInEditor = true
		showInfo = false
	}
}

@PART[TPtankR02]:NEEDS[Firespitter|InterstellarFuelSwitch&!CryoTanks&!ModularFuelTanks&!RealFuels&!B9PartSwitch]:AFTER[FuelTanksPlus]
{
	//@mass = 0
	MODULE
	{
		name:NEEDS[!InterstellarFuelSwitch] = FSfuelSwitch
		name:NEEDS[InterstellarFuelSwitch] = InterstellarFuelSwitch
		useTextureSwitchModule:NEEDS[InterstellarFuelSwitch] = True
		tankSwitchNames:NEEDS[InterstellarFuelSwitch] = MonoProp;LF+OX;LiquidFuel;Oxidizer
		resourceNames = MonoPropellant;LiquidFuel,Oxidizer;LiquidFuel;Oxidizer
		resourceAmounts = 250;90,110;180;220
		//tankMass = 0.125;0.0625;0.0625;0.0625
		//basePartMass = 0.0

		tankMass = 0.0;0.5;0.5;0.5
		basePartMass = #$../mass$

		displayCurrentTankCost = true
		hasGUI = false
		availableInFlight = false
		availableInEditor = true
		showInfo = false
	}
}

@PART[TPtankR03]:NEEDS[Firespitter|InterstellarFuelSwitch&!CryoTanks&!ModularFuelTanks&!RealFuels&!B9PartSwitch]:AFTER[FuelTanksPlus]
{
	//@mass = 0
	MODULE
	{
		name:NEEDS[!InterstellarFuelSwitch] = FSfuelSwitch
		name:NEEDS[InterstellarFuelSwitch] = InterstellarFuelSwitch
		useTextureSwitchModule:NEEDS[InterstellarFuelSwitch] = True
		tankSwitchNames:NEEDS[InterstellarFuelSwitch] = MonoProp;LF+OX;LiquidFuel;Oxidizer
		resourceNames = MonoPropellant;LiquidFuel,Oxidizer;LiquidFuel;Oxidizer
		resourceAmounts = 600;180,220;360;440
		//tankMass = 0.25;0.125;0.125;0.125
		//basePartMass = 0.0

		tankMass = 0;0.125;0.125;0.125
		basePartMass = #$../mass$

		displayCurrentTankCost = true
		hasGUI = false
		availableInFlight = false
		availableInEditor = true
		showInfo = false
	}
}
